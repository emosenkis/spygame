<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
  var map;
  var markerList = {};
      function initialize() {

        var myOptions = {
          zoom: 16,
          center: new google.maps.LatLng(42.367201,-71.258851),
          disableDefaultUI: true,
  
          
          scaleControl: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          panControl: false,
          zoomControl: false,
        
        };
        map = new google.maps.Map(document.getElementById('map_canvas'),
            myOptions);

        addMarker(42.367201,-71.258851, 1, 'test');
        
      }

      function update_positions(data) {
        //if marker exists, update its location, else create it
         var detectives=data.detectives;
         for (var d in detectives) {
            if (markerList.hasOwnProperty(d.user_id)) {
              moveMarker(markerList[d.user_id], d.latitude, d.longitude)
            }
            else {
              addMarker(d.latitude, d.longitude, d.user_id, d.name)
            }
         }
        var spy=data.spy;
        if (markerList.hasOwnProperty(spy.user_id)) {
              moveMarker(markerList[spy.user_id], spy.latitude, spy.longitude)
            }
            else {
              addMarker(spy.latitude, spy.longitude, spy.user_id, spy.name)
            }
      }

      function moveMarker(marker, lat, long ) {
        marker.setPosition(new google.maps.LatLng( lat, long));
      };

      function addMarker(lat, long, id, name){
            var marker = new google.maps.Marker({
              position: new google.maps.LatLng(lat, long),
              map: map,
              title: name
            });
            markerList[id] = marker
            //DROP MARKER INFOWINDOW
            var latlng = new google.maps.LatLng(lat, long);
            google.maps.event.addListener(marker, 'click', function(){
              infowindow.open(map, this);
              marker = this
            });
            var infowindow = new google.maps.InfoWindow({
              content: name
            });
            //CLOSING MARKER INFOWINDOW
            google.maps.event.addListener(infowindow,'closeclick',function(){
              infowindow.close(map, this); //removes the marker
            });
        }
      console.log("marker placed")
      google.maps.event.addDomListener(window, 'load', initialize);
</script>